# Elasticsearch 导入脚本修复说明

## 问题描述
在运行 `import_to_es.py` 脚本时遇到以下错误：
```
RequestError(400, 'illegal_argument_exception', 'Action/metadata line [1] contains an unknown parameter [_type]')
```

## 问题原因
从 Elasticsearch 8.0 开始，`_type` 字段已被移除，不再支持在批量导入时使用 `_type` 参数。

## 修复内容

### 1. 移除 `_type` 字段
**修改前：**
```python
es_doc = {
    '_index': index_name,
    '_type': doc_type,  # 这行会导致错误
    '_source': cleaned_source
}
```

**修改后：**
```python
es_doc = {
    '_index': index_name,
    '_source': cleaned_source
}
```

### 2. 强制使用指定索引
**修改前：**
- 使用文档中的 `_index` 字段
- 可能导入到多个不同的索引

**修改后：**
- 强制所有文档导入到 `u2performance_for_test` 索引
- 添加了 `--index` 参数支持自定义索引名

### 3. 更新相关脚本
- 修复了 `import_to_es.py` 主脚本
- 更新了 `quick_import.py` 快速导入脚本
- 确保所有脚本都使用正确的索引名

## 使用方法

### 基本用法（默认索引）
```bash
python import_to_es.py --file 222.json
```

### 指定索引
```bash
python import_to_es.py --file 222.json --index u2performance_for_test
```

### 完整参数
```bash
python import_to_es.py \
  --file 222.json \
  --host localhost \
  --port 9200 \
  --index u2performance_for_test \
  --batch-size 1000
```

## 验证修复
运行测试脚本验证修复效果：
```bash
python test_fix.py
```

## 兼容性说明
- ✅ 支持 Elasticsearch 7.x
- ✅ 支持 Elasticsearch 8.x
- ✅ 向后兼容旧版本配置
- ✅ 保持原有数据清洗功能

## 注意事项
1. 所有数据将导入到指定的单一索引中
2. 不再支持多索引导入（这是有意的设计）
3. 如需导入到其他索引，请使用 `--index` 参数
4. 确保目标索引有足够的存储空间

## 性能优化
- 默认批量大小：1000条/批
- 可通过 `--batch-size` 参数调整
- 建议根据ES集群性能调整批量大小 